{"version":3,"sources":["../../src/controllers/cameraController.js"],"names":["CameraController","ctx","data","request","body","info","msg","findOne","ip","fields","isExit","camera","save","err","name","id","params","findByIdAndRemove","exec","result","error","update","query","sort","range","filter","sortObj","JSON","parse","rangeObj","filterObj","sortP","length","pageStart","pageEnd","find","count","total","skip","limit"],"mappings":"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","file":"cameraController.js","sourcesContent":["/**\n * Created by chen on 17-8-23.\n */\nimport logger from '../logger';\nimport CameraModel from '../models/camera.model';\n\nclass CameraController {\n    static async add_camera(ctx){\n        const data = ctx.request.body;\n        logger.info(data);\n        if(!data) return ctx.body={ msg: '发送数据失败!' };\n        const isExit = await CameraModel.findOne({ip:data.fields.ip});\n        logger.info(isExit);\n        if(isExit) return ctx.body={ msg: '该摄像头ip已存在!' };\n        //const result = await CameraModel.create(data);\n\n        let camera = new CameraModel(data.fields);\n        logger.info(camera);\n        let msg = '';\n        camera.save(function (err,camera) {\n            if(!err) {\n                msg = '添加摄像头'+ camera.name +'成功';\n            }else{\n                msg = err;\n            }\n        });\n\n        return ctx.body = {msg:msg,data:camera};\n        //if(!result) return ctx.error({msg:'添加摄像头失败'})\n\n        //return ctx.body = {msg:'添加摄像头成功',data:result};\n    }\n\n    static async delete_camera(ctx) {\n        const { id } = ctx.params;\n        logger.info(id);\n        const result = await CameraModel.findByIdAndRemove(id).exec();\n        if(!result) return ctx.error={msg: '删除摄像头失败!'};\n        return ctx.body = {msg:'删除摄像头成功',data:result};\n    }\n\n    static async edit_camera(ctx){\n        const data = ctx.request.body;\n        logger.info(data);\n        const result = await CameraModel.update(data,{id:data.id}).exec();\n        if(!result) return ctx.error={msg: '修改摄像头失败!'};\n        return ctx.body = {msg:'修改摄像头成功',data:result};\n    }\n\n    static async find_camera(ctx){\n        const { sort,range,filter } = ctx.query;\n        let sortObj = JSON.parse(sort);\n        let rangeObj = JSON.parse(range);\n        let filterObj = JSON.parse(filter);\n        let sortP = {};\n        if(sortObj && sortObj.length >=2){\n            if('ASC' ===sortObj[1]){\n                sortP[sortObj[0]] = 1\n            }else{\n                sortP[sortObj[0]] = -1\n            }\n        }\n\n        let pageStart = 0,pageEnd = 0\n        if(rangeObj && rangeObj.length >=2){\n            pageStart = rangeObj[0];\n            pageEnd = rangeObj[1];\n        }\n\n        const total = await CameraModel.find(filterObj).count();\n\n        let result = await CameraModel.find(filterObj).skip(pageStart).limit(pageEnd-pageStart+1).sort(sortP);\n        //const result = await CameraModel.find().exec();\n        if(!result) return ctx.body={msg: '没有找到摄像头!'};\n        return ctx.body = {msg:'查询摄像头',data:result,total:total};\n    }\n    static async find_one(ctx){\n        const { id } = ctx.params;\n        const result = await CameraModel.findOne({id:id});\n        if(!result) return ctx.body = {msg: '没有找到摄像头!'};\n        return ctx.body = {msg:'查询摄像头',data:result};\n    }\n\n}\n\nexport default CameraController;"]}