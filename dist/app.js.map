{"version":3,"sources":["../src/app.js"],"names":["app","use","ctx","next","set","multipart","strict","formidable","uploadDir","join","__dirname","jsonLimit","formLimit","textLimit","routes","allowedMethods","connection","info","host","port","name","error","process","exit","listen","ip"],"mappings":";;AAGA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;2cAZA;;;;;AAcA,IAAMA,MAAM,mBAAZ;;AAEA;;AAEAA,IAAIC,GAAJ,CAAQ,UAACC,GAAD,EAAMC,IAAN,EAAe;AACnB;AACA;AACA;AACA;AACA;;AAEAD,QAAIE,GAAJ,CAAQ,6BAAR,EAAuC,GAAvC;AACAF,QAAIE,GAAJ,CAAQ,8BAAR,EAAwC,gDAAxC;AACAF,QAAIE,GAAJ,CAAQ,8BAAR,EAAwC,iCAAxC;AACAF,QAAIE,GAAJ,CAAQ,kCAAR,EAA4C,IAA5C,EAVmB,CAU+B;AAClD,WAAOD,MAAP;AACH,CAZD,EAYGF,GAZH,CAYO,uBAAQ;AACXI,eAAW,IADA;AAEXC,YAAQ,KAFG;AAGXC,gBAAY;AACRC,mBAAW,eAAKC,IAAL,CAAUC,SAAV,EAAqB,uBAArB;AADH,KAHD;AAMXC,eAAW,MANA;AAOXC,eAAW,MAPA;AAQXC,eAAW;AARA,CAAR,CAZP;;AAuBAb,IAAIC,GAAJ,CAAQ,iBAAOa,MAAP,EAAR,EACKb,GADL,CACS,iBAAOc,cAAP,EADT;;AAIA;AACA;AACA;AACA;AACA;;AAEA,wDAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAEgC,mBAFhC;;AAAA;AAEaC,8BAFb;;AAGO,qCAAOC,IAAP,CAAY,+BAAZ,EAA6CD,WAAWE,IAAxD,EAA8DF,WAAWG,IAAzE,EAA+EH,WAAWI,IAA1F;AAHP;AAAA;;AAAA;AAAA;AAAA;;AAKO,qCAAOC,KAAP;AACAC,4BAAQC,IAAR,CAAa,CAAC,CAAd;;AANP;AAAA;AAAA,2BASSvB,IAAIwB,MAAJ,CAAW,iBAAOL,IAAlB,EAAwB,iBAAOM,EAA/B,CATT;;AAAA;AAUG,qCAAOR,IAAP,CAAY,uBAAZ,EAAqC,iBAAOQ,EAA5C,EAAgD,iBAAON,IAAvD;;AAVH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAD;;AAaA","file":"app.js","sourcesContent":["/**\n * Created by chen on 17-8-21.\n */\nimport path from 'path';\nimport Koa from 'koa';\nimport bodyParser from 'koa-bodyparser';\nimport koaBody from 'koa-body';\nimport logger from './logger';\nimport connect from './db';\nimport babelPolyfill from 'babel-polyfill';\nimport config from './config';\nimport router from './router';\nimport cors from 'koa2-cors';\n\nconst app = new Koa();\n\n// app.use(cors())\n\napp.use((ctx, next) => {\n    // if (ctx.request.header.host.split(':')[0] === 'localhost' || ctx.request.header.host.split(':')[0] === '127.0.0.1') {\n    //     ctx.set('Access-Control-Allow-Origin', '*')\n    // } else {\n    //     ctx.set('Access-Control-Allow-Origin', config.ip)\n    // }\n\n    ctx.set('Access-Control-Allow-Origin', '*');\n    ctx.set('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept')\n    ctx.set('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS')\n    ctx.set('Access-Control-Allow-Credentials', true) // 允许带上 cookie\n    return next();\n}).use(koaBody({\n    multipart: true,\n    strict: false,\n    formidable: {\n        uploadDir: path.join(__dirname, '../assets/uploads/tmp')\n    },\n    jsonLimit: '10mb',\n    formLimit: '10mb',\n    textLimit: '10mb'\n}));\n\napp.use(router.routes())\n    .use(router.allowedMethods());\n\n\n// app.use((ctx) => {\n//\n//     logger.info(\"server\");\n//     ctx.body = \"hello,world\";\n// });\n\n(async() => {\n    try {\n        const connection = await connect();\n        logger.info('connected to MongoDB %s:%s/%s', connection.host, connection.port, connection.name);\n    }catch (error) {\n        logger.error(error);\n        process.exit(-1);\n    }\n\n    await app.listen(config.port, config.ip);\n    logger.info('Server start at %s:%s', config.ip, config.port);\n})();\n\n// app.listen(3000);"]}